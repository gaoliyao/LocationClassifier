package com.github;

import java.util.ArrayList;
import java.util.LinkedList;

/**
 * Created by mars on 09/07/2017.
 */
public class LocationAnalyzer {

    public ArrayList<Point> location_points = new ArrayList<Point>();

    public   void get_Location_Points(){
        location_points.add(new Point(40.4361051,-79.9200135));///!!!   0
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4360222,-79.9200180));
        location_points.add(new Point(40.4359695,-79.9200568));
        location_points.add(new Point(40.4361818,-79.9197170));
        location_points.add(new Point(40.4361051,-79.9200135));//分界线
        location_points.add(new Point(40.4366057,-79.9199618));
        location_points.add(new Point(40.4362921,-79.9193930));
        location_points.add(new Point(40.4369836,-79.9193064));
        location_points.add(new Point(40.4376329,-79.9193233));
        location_points.add(new Point(40.4379651,-79.9195919));         //10
        location_points.add(new Point(40.4381345,-79.9203929));
        location_points.add(new Point(40.4382487,-79.9208572));//!!!!!
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4373046,-79.9208399));
        location_points.add(new Point(40.4368511,-79.9206218));
        location_points.add(new Point(40.4386149,-79.9208194));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4381129,-79.9206464));
        location_points.add(new Point(40.4381139,-79.9206469));
        location_points.add(new Point(40.4381147,-79.9206479));//分界线      20
        location_points.add(new Point(40.4381149,-79.9206480));
        location_points.add(new Point(40.4381149,-79.9206480));
        location_points.add(new Point(40.4381149,-79.9206480));//分界线
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));//30
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));//40
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));//50
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));
        location_points.add(new Point(40.4380502,-79.9206257));//分界线
        location_points.add(new Point(40.4380195,-79.9202759));//60
        location_points.add(new Point(40.4381231,-79.9206410));
        location_points.add(new Point(40.4380369,-79.9195763));
        location_points.add(new Point(40.4376289,-79.9191028));
        location_points.add(new Point(40.4367743,-79.9196229));
        location_points.add(new Point(40.436562,-79.91949110));
        location_points.add(new Point(40.4361282,-79.9194211));
        location_points.add(new Point(40.4363561,-79.9201171));
        location_points.add(new Point(40.4358899,-79.9201375));//分界线
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));//70
        location_points.add(new Point(40.4361372,-79.9198233));
        location_points.add(new Point(40.4361205,-79.9195454));
        location_points.add(new Point(40.4359304,-79.9197084));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));//80
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));
        location_points.add(new Point(40.4361051,-79.9200135));//!!!!!!//分界线
        location_points.add(new Point(40.4361446,-79.9200069));//90
        location_points.add(new Point(40.4361436,-79.9200079));
        location_points.add(new Point(40.4361593,-79.9200417));
        location_points.add(new Point(40.4360895,-79.9207432));
        location_points.add(new Point(40.4361193,-79.9213981));
        location_points.add(new Point(40.4358815,-79.9224665));
        location_points.add(new Point(40.4364998,-79.9229816));
        location_points.add(new Point(40.4368966,-79.9228510));
        location_points.add(new Point(40.4368888,-79.9233166));
        location_points.add(new Point(40.4377553,-79.9225694));
        location_points.add(new Point(40.4383156,-79.9229693));//100
        location_points.add(new Point(40.4380209,-79.9229868));
        location_points.add(new Point(40.4383327,-79.9229558));
        location_points.add(new Point(40.4383285,-79.9229534));//分界线
        location_points.add(new Point(40.4383280,-79.9229541));
        location_points.add(new Point(40.4383689,-79.9224621));//!!!!!!
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4384359,-79.9231904));
        location_points.add(new Point(40.4383689,-79.9224621));///!!!
        location_points.add(new Point(40.4383766,-79.9225496));//110
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4384477,-79.9224621));
        location_points.add(new Point(40.4384477,-79.9224621));
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4382282,-79.9231892));
        location_points.add(new Point(40.4383755,-79.9225542));//120
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383689,-79.9224621));///!!!
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4383689,-79.9224621));//!!!
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4383689,-79.9224621));
        location_points.add(new Point(40.4385389,-79.9229076));//130
        location_points.add(new Point(40.4383689,-79.9224621));///!!!
        location_points.add(new Point(40.4379209,-79.9229187));
        location_points.add(new Point(40.4378128,-79.9229347));
        location_points.add(new Point(40.4383756,-79.9225503));
        location_points.add(new Point(40.4383766,-79.9225496));///!!!
        location_points.add(new Point(40.4380556,-79.9228603));
        location_points.add(new Point(40.4381255,-79.9232075));
        location_points.add(new Point(40.4381994,-79.9234575));
        location_points.add(new Point(40.4383769,-79.9235635));
        location_points.add(new Point(40.4382917,-79.9233757));//140
        location_points.add(new Point(40.4385272,-79.9234484));
        location_points.add(new Point(40.4385979,-79.9233583));
        location_points.add(new Point(40.4383766,-79.9225496));
        location_points.add(new Point(40.4385515,-79.9227876));
        location_points.add(new Point(40.4386686,-79.9230937));
        location_points.add(new Point(40.4383766,-79.9225496));














    }

    public  final Double Radius = 0.0000005;//(rsquare)

    public LinkedList<Point> Point_Analyzer = new LinkedList<Point>();
    public  LinkedList<Point> Point_in_three = new LinkedList<Point>();

    public  boolean isAlarmed_left = true;

//    public static boolean isAlarmed_arrived = false;

    public  int status = 0;
    // 0 Staying
    // 1 Moving
    //
    //

    public  ArrayList<Point> location_list= new ArrayList<Point>();

    public  Double distance(Point a, Point b){
        return (a.x-b.x)*(a.x-b.x) + (a.y-b.y)*(a.y-b.y);
    }

    public  void read(int i){

        if(Point_Analyzer.size()==9) {
            Point_Analyzer.remove(0);
            Point_Analyzer.add(location_points.get(i));
//            System.out.println(i);
//            System.out.println(location_points.get(i).x);
//            System.out.println(Point_Analyzer.get(8).x);
            Point_Analyzer.get(8).index=i*1.0;
            Point_Analyzer.get(8).start_index=i*1.0;
            Point_Analyzer.get(8).end_index=i*1.0;
        }
        else{
            Point_Analyzer.add(location_points.get(i));
//            System.out.println(i);
//            System.out.println(location_points.get(i).x);
//            System.out.println(Point_Analyzer.get(i).x);
            Point_Analyzer.get(i).index=i*1.0;
            Point_Analyzer.get(i).start_index=i*1.0;
            Point_Analyzer.get(i).end_index=i*1.0;
        }


        if( (i+1) % 3 == 0){
            if(Point_in_three.size()==3){
                Point_in_three.remove(0);
                Double new_x = (Point_Analyzer.get(8).x+ Point_Analyzer.get(7).x+ Point_Analyzer.get(6).x)/3;
                Double new_y = (Point_Analyzer.get(8).y+ Point_Analyzer.get(7).y+ Point_Analyzer.get(6).y)/3;
                Point_in_three.add(new Point(new_x, new_y));

                Point_in_three.get(2).start_index = i*1.0-2;
                Point_in_three.get(2).end_index = i*1.0;
                Point_in_three.get(2).index = i-0.5;


            }
            else{
                Point_in_three.add(new Point((Point_Analyzer.get(i).x+
                        Point_Analyzer.get(i-1).x+ Point_Analyzer.get(i-2).x)/3, (Point_Analyzer.get(i).y+ Point_Analyzer.get(i-1).y+
                        Point_Analyzer.get(i-2).y)/3));
                Point_in_three.get(i/3).start_index = i*1.0-2;
                Point_in_three.get(i/3).end_index = i*1.0;
                Point_in_three.get(i/3).index = i-0.5;
            }
        }



    }

    public  void is_left(){
        if(isAlarmed_left){
            //Alarmed

            int ab = (distance(Point_in_three.get(0),Point_in_three.get(1)) < Radius)? 0:1;
            int bc = (distance(Point_in_three.get(1),Point_in_three.get(2)) < Radius)? 0:1 ;
            int ac = (distance(Point_in_three.get(0),Point_in_three.get(2)) < Radius)? 0:1 ;

            if(ab == 1 && bc==1 && ac==1){
                isAlarmed_left=false;
                status = 1;
                location_list.get(location_list.size()-1).end_index=Point_in_three.get(0).index;
            }
            else if(ab==1 && bc==1 && ac==0) {
                isAlarmed_left=false;
            }
            else if(ab==1 && bc==0 && ac==1){
                isAlarmed_left=false;
                location_list.add(Point_in_three.get(1));
                location_list.get(location_list.size()-1).start_index=Point_in_three.get(1).index;
            }else{isAlarmed_left=false;}

        }else{
            //Not Alarmed

            if(distance(Point_in_three.get(2),Point_in_three.get(1)) < Radius){
                isAlarmed_left = false;
            }else{
                isAlarmed_left = true;
            }

        }
    }

    public  void is_arrived(){

        //Not Alarmed

        if(distance(Point_in_three.get(2),Point_in_three.get(1)) < Radius){
            //isAlarmed_arrived = true;
            status = 0;
            location_list.add(Point_in_three.get(2));
            location_list.get(location_list.size()-1).start_index = Point_in_three.get(1).index;
        }else{
        }


    }

    public   void Classify(){

        get_Location_Points();

        for(int i=0;i<location_points.size();i++)System.out.println(location_points.get(i).y);

        for(int i=0;i<9;i++) {
            read(i);
        }
        location_list.add(Point_in_three.get(0));

        for(int i=9;i<location_points.size();i++)
        {

            read(i);

            if( (i+1) % 3 == 0){
                status_judgement();
            }else{

            }

        }

        check_result();

    }

    private  void check_result() {


        for(int i=0;i<location_list.size();i++){
            System.out.println("x:"+location_list.get(i).x+" y:"+location_list.get(i).y+" start_index"+location_list.get(i).start_index+" end_index:"+location_list.get(i).end_index+" index:"+location_list.get(i).index);
            if(i>0)
                System.out.println("distance: " + distance(location_list.get(i),location_list.get(i-1)));
            System.out.println();
        }

    }

    private  void status_judgement() {
        if(status == 0){
            is_left();
        }
        if(status == 1){
            is_arrived();
        }
    }
}
